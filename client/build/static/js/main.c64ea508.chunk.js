(this["webpackJsonpmusic-tree-client"]=this["webpackJsonpmusic-tree-client"]||[]).push([[0],{16:function(e,t,n){},17:function(e,t,n){},18:function(e,t,n){},21:function(e,t,n){},22:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n(1),a=n.n(c),s=n(9),i=n.n(s),o=(n(16),n(3)),u=(n(17),n(18),n(2)),l=n(4),f=n.n(l),d=n(6),h="http://localhost:5000";function j(e){return b.apply(this,arguments)}function b(){return(b=Object(d.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={headers:{Authorization:"Bearer "+localStorage.getItem("accessToken")},json:!0},e.abrupt("return",fetch(t,n).then(function(){var e=Object(d.a)(f.a.mark((function e(n){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.ok){e.next=6;break}if(401!==n.status&&401!==(null===(r=n.error)||void 0===r?void 0:r.status)){e.next=5;break}return e.next=4,p();case 4:return e.abrupt("return",j(t));case 5:throw n;case 6:return e.abrupt("return",n.json());case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){return e})).catch((function(e){return console.error("Catched Error:",e),e})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(){return k.apply(this,arguments)}function k(){return(k=Object(d.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O();case 2:console.log("refreshing token:"+localStorage.getItem("refreshToken")),fetch("".concat(h,"/refresh_token?refresh_token=")+localStorage.getItem("refreshToken")).then((function(e){var t;if(!e.ok)throw 401!==e.status&&401!==(null===(t=e.error)||void 0===t?void 0:t.status)||console.log("Refreshing token failed."),e;return e.json()})).then((function(e){return localStorage.setItem("accessToken",e.access_token),e.access_token})).catch((function(e){console.error("Refreshing token error:",e)}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(){return m.apply(this,arguments)}function m(){return(m=Object(d.a)(f.a.mark((function e(){var t,n,r,c,a;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=window.location.search,n=new URLSearchParams(t),r={refresh_token:n.get("refresh_token"),access_token:n.get("access_token")},c=localStorage.getItem("accessToken"),a=localStorage.getItem("refreshToken"),""!==r.refresh_token&&r.refresh_token||""!==a&&a&&"null"!==a){e.next=8;break}return window.location.href="".concat(h,"/authorization"),e.abrupt("return");case 8:localStorage.setItem("accessToken",r.access_token||c),localStorage.setItem("refreshToken",r.refresh_token||a);case 10:case"end":return e.stop()}}),e)})))).apply(this,arguments)}O();var g=function(e){var t=e.setLoadedData,n=Object(c.useState)({}),a=Object(o.a)(n,2),s=a[0],i=a[1];return Object(c.useEffect)((function(){t((function(e){return[].concat(Object(u.a)(e),[{user:!1}])})),j("https://api.spotify.com/v1/me").then((function(e){return i(e)||{}})).then((function(){return t((function(e){return[].concat(Object(u.a)(e),[{user:!0}])}))}))}),[]),Object(r.jsx)("p",{className:"user secondary",children:s.display_name})},x=n(10),v=n.n(x),y=(n(21),Object(r.jsx)("svg",{viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",children:Object(r.jsx)("path",{d:"M7.5 15V8.5m0 0a4 4 0 100-8 4 4 0 000 8z",stroke:"currentColor"})})),w=Object(r.jsx)("svg",{viewBox:"0 0 15 15",fill:"none",xmlns:"http://www.w3.org/2000/svg",width:"15",height:"15",children:Object(r.jsx)("path",{d:"M7.5 0A4.5 4.5 0 007 8.973V15h1V8.973A4.5 4.5 0 007.5 0z",fill:"currentColor"})});var S=function(e){var t,n=e.playlist,c=e.toggleTracks,a=e.pinPlaylist,s=e.unPinPlaylist,i=e.isChecked,o=e.isPinned;return Object(r.jsx)("div",{children:n.tracks?Object(r.jsxs)(r.Fragment,{children:[o(n.id)?Object(r.jsx)("button",{onClick:function(){return s(n.id)},children:Object(r.jsxs)("div",{children:[w," Unpin"]})}):Object(r.jsx)("button",{onClick:function(){return a(n)},children:Object(r.jsxs)("div",{children:[y," Pin"]})}),Object(r.jsx)("ul",{children:null===(t=n.tracks)||void 0===t?void 0:t.map((function(e){return Object(r.jsxs)("li",{name:e.id,children:[Object(r.jsx)("input",{type:"checkbox",checked:i(e.id),name:e.id,onChange:function(e){c(e),a(n)}}),e.artists[0].name," - ",e.name]},e.id)}))})]}):"Select up to 5 tracks as seeds for recommendations."},n.id)};var P=function(e){var t=e.currentPlaylistIndex,n=e.allPlaylists,c=e.displayPreviousPlaylist,a=e.displayNextPlaylist;return Object(r.jsxs)(r.Fragment,{children:[t>0?Object(r.jsx)("button",{className:"previous-button",onClick:c,children:"previous"}):"",t+1<n.length?Object(r.jsx)("button",{className:"next-button",onClick:a,children:"next"}):""]})};var T=function(e){var t=e.seedTracks,n=Object(c.useState)([]),a=Object(o.a)(n,2),s=a[0],i=a[1];return Object(c.useEffect)((function(){for(var e=[],n=0;n<5;n++)n<t.length?e.push("@"):e.push("O");i(e)}),[t]),Object(r.jsxs)("p",{className:"seeds secondary",children:["Seeds:"," ",s.map((function(e,t){return Object(r.jsx)("span",{className:"circle",children:e},t)}))]})};var C=function(e){var t=e.setLoadedData,n=Object(c.useState)([]),a=Object(o.a)(n,2),s=a[0],i=a[1],l=Object(c.useState)([]),f=Object(o.a)(l,2),d=f[0],h=f[1],b=Object(c.useState)([]),p=Object(o.a)(b,2),k=p[0],O=p[1],m=Object(c.useState)([]),g=Object(o.a)(m,2),x=g[0],y=g[1],w=Object(c.useState)([]),C=Object(o.a)(w,2),_=C[0],I=C[1];Object(c.useEffect)((function(){t((function(e){return[].concat(Object(u.a)(e),[{likedTracks:!1}])})),j("https://api.spotify.com/v1/me/tracks").then((function(e){return i(e.items)})).then((function(){t((function(e){return[].concat(Object(u.a)(e),[{likedTracks:!0}])}))}))}),[]),Object(c.useEffect)((function(){var e;0!==k.length&&(e=k,j("https://api.spotify.com/v1/recommendations?seed_tracks="+e.reduce((function(e,t,n){return 0===n?t.id:e+","+t.id}),""))).then((function(e){var t=v()();h({id:t,tracks:e.tracks}||[])}))}),[k]);var L=Object(c.useState)([]),N=Object(o.a)(L,2),E=N[0],F=N[1];function B(e){if(!(k.length>=5&&e.target.checked))if(k.some((function(t){return t.id===e.target.name})))O(k.filter((function(t){return t.id!==e.target.name})));else{var t=x.reduce((function(e,t){return[].concat(Object(u.a)(e),Object(u.a)(t.tracks))}),[]),n=d.tracks?d.tracks.filter((function(t){return t.id===e.target.name})):[];O([].concat(Object(u.a)(k),Object(u.a)(s.filter((function(t){return t.track.id===e.target.name})).map((function(e){return e.track}))),Object(u.a)(t.filter((function(t){return t.id===e.target.name}))),Object(u.a)(n)))}}function D(e){return k.some((function(t){return t.id===e}))}Object(c.useEffect)((function(){var e=x.some((function(e){return e.id===d.id}))?x:[].concat(Object(u.a)(x),[d]);F(e),I(e[e.length-1])}),[x,d]);var z=E.indexOf(_);return Object(r.jsxs)("div",{className:"playlists",children:[Object(r.jsx)(T,{seedTracks:k}),Object(r.jsx)("h2",{children:"Liked tracks"}),Object(r.jsx)("ul",{children:s&&s.length?s.map((function(e){return Object(r.jsxs)("li",{children:[Object(r.jsx)("input",{type:"checkbox",checked:D(e.track.id),name:e.track.id,onChange:B}),e.track.artists[0].name," - ",e.track.name]},e.track.id)})):"Your liked tracks from Spotify will appear here."}),Object(r.jsx)("h2",{children:"Recommended tracks"}),Object(r.jsx)(P,{currentPlaylistIndex:z,allPlaylists:E,displayPreviousPlaylist:function(){z<=0||I(E[z-1])},displayNextPlaylist:function(){z+1!==E.length&&I(E[z+1])}}),Object(r.jsx)(S,{playlist:_,toggleTracks:B,pinPlaylist:function(e){x.some((function(t){return t.id===e.id}))||y([].concat(Object(u.a)(x),[e]))},unPinPlaylist:function(e){y(x.filter((function(t){return t.id!==e})))},isChecked:D,isPinned:function(e){return x.some((function(t){return e===t.id}))}},_.id)]})};var _=function(){var e=Object(c.useState)([]),t=Object(o.a)(e,2),n=t[0],a=t[1];return Object(r.jsxs)("div",{className:"App",children:[n.some((function(e){return!e}))?Object(r.jsx)("p",{children:"Loading..."}):"",Object(r.jsx)(g,{setLoadedData:a}),Object(r.jsx)(C,{setLoadedData:a})]})},I=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,23)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,s=t.getTTFB;n(e),r(e),c(e),a(e),s(e)}))};i.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(_,{})}),document.getElementById("root")),I()}},[[22,1,2]]]);
//# sourceMappingURL=main.c64ea508.chunk.js.map