(this["webpackJsonpmusic-tree-client"]=this["webpackJsonpmusic-tree-client"]||[]).push([[0],{16:function(e,t,n){},17:function(e,t,n){},20:function(e,t,n){"use strict";n.r(t);var r=n(0),c=n(1),a=n.n(c),o=n(9),s=n.n(o),i=(n(16),n(3)),u=(n(17),n(2)),l=n(4),f=n.n(l),d=n(6),h=(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).PORT,"https://spotify-moodboard.herokuapp.com");function j(e){return k.apply(this,arguments)}function k(){return(k=Object(d.a)(f.a.mark((function e(t){var n;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={headers:{Authorization:"Bearer "+localStorage.getItem("accessToken")},json:!0},e.abrupt("return",fetch(t,n).then(function(){var e=Object(d.a)(f.a.mark((function e(n){var r;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.ok){e.next=6;break}if(401!==n.status&&401!==(null===(r=n.error)||void 0===r?void 0:r.status)){e.next=5;break}return e.next=4,p();case 4:return e.abrupt("return",j(t));case 5:throw n;case 6:return e.abrupt("return",n.json());case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){return console.log("Success:",e),e})).catch((function(e){return console.error("Catched Error:",e),e})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(){return b.apply(this,arguments)}function b(){return(b=Object(d.a)(f.a.mark((function e(){return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O();case 2:console.log("refreshing token:"+localStorage.getItem("refreshToken")),fetch("".concat(h,"/refresh_token?refresh_token=")+localStorage.getItem("refreshToken")).then((function(e){var t;if(!e.ok)throw 401!==e.status&&401!==(null===(t=e.error)||void 0===t?void 0:t.status)||console.log("Refreshing token failed."),e;return e.json()})).then((function(e){return console.log("Refreshing token success:",e),localStorage.setItem("accessToken",e.access_token),e.access_token})).catch((function(e){console.error("Refreshing token error:",e)}));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(){return m.apply(this,arguments)}function m(){return(m=Object(d.a)(f.a.mark((function e(){var t,n,r,c;return f.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("".concat(h,"/tokens"));case 2:return t=e.sent,e.next=5,t.json();case 5:n=e.sent,r=localStorage.getItem("accessToken"),c=localStorage.getItem("refreshToken"),""!==n.refresh_token||""!==c&&c&&"null"!==c||(window.location.href="".concat(h,"/authorization")),localStorage.setItem("accessToken",n.access_token||r),localStorage.setItem("refreshToken",n.refresh_token||c);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}O();var g=function(e){var t=e.setLoadedData,n=Object(c.useState)({}),a=Object(i.a)(n,2),o=a[0],s=a[1];return Object(c.useEffect)((function(){t((function(e){return[].concat(Object(u.a)(e),[{user:!1}])})),j("https://api.spotify.com/v1/me").then((function(e){return s(e)||{}})).then((function(){return t((function(e){return[].concat(Object(u.a)(e),[{user:!0}])}))}))}),[]),Object(r.jsx)("p",{children:o.display_name})},v=n(10),x=n.n(v);var S=function(e){var t=e.playlist,n=e.toggleTracks,c=e.pinPlaylist,a=e.isChecked;return Object(r.jsx)("ul",{children:t.tracks.map((function(e){return Object(r.jsxs)("li",{name:e.id,children:[Object(r.jsx)("input",{type:"checkbox",checked:a(e.id),name:e.id,onChange:function(e){n(e),c(t)}}),e.artists[0].name," - ",e.name]},e.id)}))},t.id)};var T=function(e){e.loadedData;var t,n=e.setLoadedData,a=Object(c.useState)([]),o=Object(i.a)(a,2),s=o[0],l=o[1],f=Object(c.useState)([]),d=Object(i.a)(f,2),h=d[0],k=d[1],p=Object(c.useState)([]),b=Object(i.a)(p,2),O=b[0],m=b[1],g=Object(c.useState)([]),v=Object(i.a)(g,2),T=v[0],y=v[1];function _(e){if(!(O.length>=5&&e.target.checked))if(O.some((function(t){return t.id===e.target.name})))m(O.filter((function(t){return t.id!==e.target.name})));else{var t=T.reduce((function(e,t){return[].concat(Object(u.a)(e),Object(u.a)(t.tracks))}),[]),n=h.tracks?h.tracks.filter((function(t){return t.id===e.target.name})):[];m([].concat(Object(u.a)(O),Object(u.a)(s.filter((function(t){return t.track.id===e.target.name})).map((function(e){return e.track}))),Object(u.a)(t.filter((function(t){return t.id===e.target.name}))),Object(u.a)(n)))}}function C(e){return O.some((function(t){return t.id===e}))}function w(e){T.some((function(t){return t.id===e.id}))||y([].concat(Object(u.a)(T),[e]))}return Object(c.useEffect)((function(){n((function(e){return[].concat(Object(u.a)(e),[{likedTracks:!1}])})),j("https://api.spotify.com/v1/me/tracks").then((function(e){return console.log("likeTracks",e),l(e.items)})).then((function(){n((function(e){return[].concat(Object(u.a)(e),[{likedTracks:!0}])}))}))}),[]),Object(c.useEffect)((function(){var e;0!==O.length&&(e=O,j("https://api.spotify.com/v1/recommendations?seed_tracks="+e.reduce((function(e,t,n){return 0===n?t.id:e+","+t.id}),""))).then((function(e){return k({id:x()(),tracks:e.tracks}||[])}))}),[O]),Object(r.jsxs)(r.Fragment,{children:[Object(r.jsxs)("p",{children:["Seeds: ",5-O.length]}),Object(r.jsx)("p",{children:"Liked tracks"}),Object(r.jsx)("ul",{children:s&&s.length?s.map((function(e){return Object(r.jsxs)("li",{children:[Object(r.jsx)("input",{type:"checkbox",checked:C(e.track.id),name:e.track.id,onChange:_}),e.track.artists[0].name," - ",e.track.name]},e.track.id)})):"Loading liked tracks..."}),Object(r.jsx)("p",{children:"Recommended tracks"}),T.length?T.map((function(e){return Object(r.jsxs)("ul",{children:[Object(r.jsx)("button",{onClick:function(){return t=e.id,void y(T.filter((function(e){return e.id!==t})));var t},children:"Unpin"}),Object(r.jsx)(S,{playlist:e,toggleTracks:_,pinPlaylist:w,isChecked:C})]},e.id)})):"",Object(r.jsx)("ul",{children:(null===(t=h.tracks)||void 0===t?void 0:t.length)?Object(r.jsxs)(r.Fragment,{children:[Object(r.jsx)("button",{onClick:function(){return w(h)},children:"Pin"}),Object(r.jsx)(S,{playlist:h,toggleTracks:_,pinPlaylist:w,isChecked:C})]}):"Select up to 5 tracks as seeds for recommendations."})]})};var y=function(){var e=Object(c.useState)([]),t=Object(i.a)(e,2),n=t[0],a=t[1];return Object(r.jsxs)("div",{className:"App",children:[n.some((function(e){return!e}))?Object(r.jsx)("p",{children:"Loading..."}):"",Object(r.jsx)(g,{setLoadedData:a}),Object(r.jsx)(T,{setLoadedData:a})]})},_=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,21)).then((function(t){var n=t.getCLS,r=t.getFID,c=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),r(e),c(e),a(e),o(e)}))};s.a.render(Object(r.jsx)(a.a.StrictMode,{children:Object(r.jsx)(y,{})}),document.getElementById("root")),_()}},[[20,1,2]]]);
//# sourceMappingURL=main.0710840f.chunk.js.map