{"version":3,"sources":["services.js","components/User.js","components/Playlist.js","components/Playlists.js","App.js","reportWebVitals.js","index.js"],"names":["getData","url","a","options","headers","Authorization","localStorage","getItem","json","fetch","then","response","ok","status","error","refresh","data","console","log","catch","callback","getTokens","setItem","access_token","tokens","prevAccessToken","prevRefreshToken","refresh_token","window","location","href","User","setLoadedData","useState","user","setUser","useEffect","prevState","r","display_name","Playlist","playlist","toggleTracks","pinPlaylist","isChecked","tracks","map","track","name","id","type","checked","onChange","e","artists","Playlists","loadedData","likedTracks","setLikedTracks","recommendedTracks","setRecommendedTracks","seedTracks","setSeedtracks","pinnedPlaylists","setPinnedPlaylists","length","target","some","filter","pinnedTracks","reduce","p","c","recommended","seed","pinned","items","seeds","i","uniqueId","pinnedPlaylist","onClick","App","className","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.b0c9231d.chunk.js","sourcesContent":["getTokens();\r\n\r\nfunction getUser() {\r\n  return getData('https://api.spotify.com/v1/me');\r\n}\r\nfunction getLikedTracks() {\r\n  return getData('https://api.spotify.com/v1/me/tracks');\r\n}\r\nfunction getRecommendedTracks(seeds) {\r\n  const uri =\r\n    'https://api.spotify.com/v1/recommendations?seed_tracks=' +\r\n    seeds.reduce((p, c, i) => (i === 0 ? c.id : p + ',' + c.id), '');\r\n  return getData(uri);\r\n}\r\n\r\nasync function getData(url) {\r\n  const options = {\r\n    headers: { Authorization: 'Bearer ' + localStorage.getItem('accessToken') },\r\n    json: true,\r\n  };\r\n\r\n  return fetch(url, options)\r\n    .then(response => {\r\n      if (!response.ok) {\r\n        if (response.status === 401 || response.error?.status === 401) {\r\n          refresh(() => getData(url));\r\n        }\r\n        throw response;\r\n      }\r\n      return response.json();\r\n    })\r\n    .then(data => {\r\n      console.log('Success:', data);\r\n      return data;\r\n    })\r\n    .catch(error => {\r\n      console.error('Catched Error:', error);\r\n      return error;\r\n    });\r\n}\r\n\r\nasync function refresh(callback) {\r\n  await getTokens();\r\n  console.log('refreshing token:' + localStorage.getItem('refreshToken'));\r\n  fetch(\r\n    'http://localhost:8888/refresh_token?refresh_token=' +\r\n      localStorage.getItem('refreshToken')\r\n  )\r\n    .then(response => {\r\n      if (!response.ok) {\r\n        if (response.status === 401 || response.error?.status === 401) {\r\n          console.log('Refreshing token failed.');\r\n        }\r\n        throw response;\r\n      }\r\n      return response.json();\r\n    })\r\n    .then(data => {\r\n      console.log('Success:', data);\r\n      localStorage.setItem('accessToken', data.access_token);\r\n      callback();\r\n    })\r\n    .catch(error => {\r\n      console.error('Error:', error);\r\n    });\r\n}\r\n\r\nasync function getTokens() {\r\n  const response = await fetch('http://localhost:8888/tokens');\r\n  const tokens = await response.json();\r\n  const prevAccessToken = localStorage.getItem('accessToken');\r\n  const prevRefreshToken = localStorage.getItem('refreshToken');\r\n  if (\r\n    tokens.refresh_token === '' &&\r\n    (prevRefreshToken === '' || !prevRefreshToken)\r\n  ) {\r\n    window.location.href = 'http://localhost:8888';\r\n  }\r\n  localStorage.setItem('accessToken', tokens.access_token || prevAccessToken);\r\n  localStorage.setItem(\r\n    'refreshToken',\r\n    tokens.refresh_token || prevRefreshToken\r\n  );\r\n}\r\n\r\nexport { getUser, getLikedTracks, getRecommendedTracks, getTokens };\r\n","import { useEffect, useState } from 'react';\r\n\r\nimport { getUser } from '../services';\r\n\r\nfunction User({ setLoadedData }) {\r\n  const [user, setUser] = useState({});\r\n\r\n  useEffect(() => {\r\n    setLoadedData(prevState => [...prevState, { user: false }]);\r\n    getUser()\r\n      .then(r => setUser(r) || {})\r\n      .then(() => setLoadedData(prevState => [...prevState, { user: true }]));\r\n  }, []);\r\n  return <p>{user.display_name}</p>;\r\n}\r\nexport default User;\r\n","function Playlist({ playlist, toggleTracks, pinPlaylist, isChecked }) {\r\n  return (\r\n    <ul key={playlist.id}>\r\n      {playlist.tracks.map(track => (\r\n        <li key={track.id} name={track.id}>\r\n          <input\r\n            type=\"checkbox\"\r\n            checked={isChecked(track.id)}\r\n            name={track.id}\r\n            onChange={e => {\r\n              toggleTracks(e);\r\n              pinPlaylist(playlist);\r\n            }}\r\n          />\r\n          {track.artists[0].name} - {track.name}\r\n        </li>\r\n      ))}\r\n    </ul>\r\n  );\r\n}\r\nexport default Playlist;\r\n","import { useEffect, useState } from 'react';\r\nimport uniqueId from 'lodash.uniqueid';\r\n\r\nimport { getLikedTracks, getRecommendedTracks } from '../services';\r\nimport Playlist from './Playlist';\r\n\r\nfunction Playlists({ loadedData, setLoadedData }) {\r\n  const [likedTracks, setLikedTracks] = useState([]);\r\n  const [recommendedTracks, setRecommendedTracks] = useState([]);\r\n  const [seedTracks, setSeedtracks] = useState([]);\r\n  const [pinnedPlaylists, setPinnedPlaylists] = useState([]);\r\n\r\n  useEffect(() => {\r\n    setLoadedData(prevState => [...prevState, { likedTracks: false }]);\r\n    getLikedTracks()\r\n      .then(r => setLikedTracks(r.items))\r\n      .then(() => {\r\n        setLoadedData(prevState => [...prevState, { likedTracks: true }]);\r\n      });\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (seedTracks.length === 0) return;\r\n    getRecommendedTracks(seedTracks).then(r =>\r\n      setRecommendedTracks({ id: uniqueId(), tracks: r.tracks } || [])\r\n    );\r\n  }, [seedTracks]);\r\n\r\n  function toggleTracks(e) {\r\n    if (seedTracks.length >= 5 && e.target.checked) return;\r\n    if (seedTracks.some(track => track.id === e.target.name)) {\r\n      setSeedtracks(seedTracks.filter(track => track.id !== e.target.name));\r\n      return;\r\n    }\r\n    const pinnedTracks = pinnedPlaylists.reduce(\r\n      (p, c) => [...p, ...c.tracks],\r\n      []\r\n    );\r\n    const recommended = recommendedTracks.tracks\r\n      ? recommendedTracks.tracks.filter(track => track.id === e.target.name)\r\n      : [];\r\n    setSeedtracks([\r\n      ...seedTracks,\r\n      ...likedTracks\r\n        .filter(track => track.track.id === e.target.name)\r\n        .map(track => track.track),\r\n      ...pinnedTracks.filter(track => track.id === e.target.name),\r\n      ...recommended,\r\n    ]);\r\n  }\r\n\r\n  function isChecked(id) {\r\n    return seedTracks.some(seed => seed.id === id);\r\n  }\r\n\r\n  function pinPlaylist(playlist) {\r\n    if (pinnedPlaylists.some(pinned => pinned.id === playlist.id)) return;\r\n    setPinnedPlaylists([...pinnedPlaylists, playlist]);\r\n  }\r\n  function unPinPlaylist(id) {\r\n    setPinnedPlaylists(pinnedPlaylists.filter(pinned => pinned.id !== id));\r\n  }\r\n\r\n  return (\r\n    <>\r\n      <p>Seeds: {5 - seedTracks.length}</p>\r\n      <p>Liked tracks</p>\r\n      <ul>\r\n        {likedTracks.length\r\n          ? likedTracks.map(track => (\r\n              <li key={track.track.id}>\r\n                <input\r\n                  type=\"checkbox\"\r\n                  checked={isChecked(track.track.id)}\r\n                  name={track.track.id}\r\n                  onChange={toggleTracks}\r\n                />\r\n                {track.track.artists[0].name} - {track.track.name}\r\n              </li>\r\n            ))\r\n          : 'Loading liked tracks...'}\r\n      </ul>\r\n      <p>Recommended tracks</p>\r\n      {pinnedPlaylists.length\r\n        ? pinnedPlaylists.map(pinnedPlaylist => (\r\n            <ul key={pinnedPlaylist.id}>\r\n              <button onClick={() => unPinPlaylist(pinnedPlaylist.id)}>\r\n                Unpin\r\n              </button>\r\n              <Playlist\r\n                playlist={pinnedPlaylist}\r\n                toggleTracks={toggleTracks}\r\n                pinPlaylist={pinPlaylist}\r\n                isChecked={isChecked}\r\n              />\r\n            </ul>\r\n          ))\r\n        : ''}\r\n      <ul>\r\n        {recommendedTracks.tracks?.length ? (\r\n          <>\r\n            <button onClick={() => pinPlaylist(recommendedTracks)}>Pin</button>\r\n            <Playlist\r\n              playlist={recommendedTracks}\r\n              toggleTracks={toggleTracks}\r\n              pinPlaylist={pinPlaylist}\r\n              isChecked={isChecked}\r\n            />\r\n          </>\r\n        ) : (\r\n          'Select up to 5 tracks as seeds for recommendations.'\r\n        )}\r\n      </ul>\r\n    </>\r\n  );\r\n}\r\n\r\nexport default Playlists;\r\n","import './App.css';\nimport { useState } from 'react';\n\nimport User from './components/User';\nimport Playlists from './components/Playlists';\n\nfunction App() {\n  const [loadedData, setLoadedData] = useState([]);\n\n  return (\n    <div className=\"App\">\n      {loadedData.some(data => !data) ? <p>Loading...</p> : ''}\n      <User setLoadedData={setLoadedData} />\n      <Playlists setLoadedData={setLoadedData} />\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}