(this["webpackJsonpmusic-tree-client"]=this["webpackJsonpmusic-tree-client"]||[]).push([[0],{16:function(t,e,n){},17:function(t,e,n){},20:function(t,e,n){"use strict";n.r(e);var c=n(0),r=n(1),a=n.n(r),o=n(9),s=n.n(o),i=(n(16),n(3)),u=(n(17),n(2)),l=n(4),f=n.n(l),d=n(7);function h(t){return j.apply(this,arguments)}function j(){return(j=Object(d.a)(f.a.mark((function t(e){var n;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={headers:{Authorization:"Bearer "+localStorage.getItem("accessToken")},json:!0},t.abrupt("return",fetch(e,n).then((function(t){var n;if(!t.ok)throw 401!==t.status&&401!==(null===(n=t.error)||void 0===n?void 0:n.status)||k((function(){return h(e)})),t;return t.json()})).then((function(t){return console.log("Success:",t),t})).catch((function(t){return console.error("Catched Error:",t),t})));case 2:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function k(t){return p.apply(this,arguments)}function p(){return(p=Object(d.a)(f.a.mark((function t(e){return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,b();case 2:console.log("refreshing token:"+localStorage.getItem("refreshToken")),fetch("http://localhost:8888/refresh_token?refresh_token="+localStorage.getItem("refreshToken")).then((function(t){var e;if(!t.ok)throw 401!==t.status&&401!==(null===(e=t.error)||void 0===e?void 0:e.status)||console.log("Refreshing token failed."),t;return t.json()})).then((function(t){console.log("Success:",t),localStorage.setItem("accessToken",t.access_token),e()})).catch((function(t){console.error("Error:",t)}));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function b(){return O.apply(this,arguments)}function O(){return(O=Object(d.a)(f.a.mark((function t(){var e,n,c,r;return f.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("http://localhost:8888/tokens");case 2:return e=t.sent,t.next=5,e.json();case 5:n=t.sent,c=localStorage.getItem("accessToken"),r=localStorage.getItem("refreshToken"),""!==n.refresh_token||""!==r&&r||(window.location.href="http://localhost:8888"),localStorage.setItem("accessToken",n.access_token||c),localStorage.setItem("refreshToken",n.refresh_token||r);case 11:case"end":return t.stop()}}),t)})))).apply(this,arguments)}b();var m=function(t){var e=t.setLoadedData,n=Object(r.useState)({}),a=Object(i.a)(n,2),o=a[0],s=a[1];return Object(r.useEffect)((function(){e((function(t){return[].concat(Object(u.a)(t),[{user:!1}])})),h("https://api.spotify.com/v1/me").then((function(t){return s(t)||{}})).then((function(){return e((function(t){return[].concat(Object(u.a)(t),[{user:!0}])}))}))}),[]),Object(c.jsx)("p",{children:o.display_name})},g=n(10),x=n.n(g);var v=function(t){var e=t.playlist,n=t.toggleTracks,r=t.pinPlaylist,a=t.isChecked;return Object(c.jsx)("ul",{children:e.tracks.map((function(t){return Object(c.jsxs)("li",{name:t.id,children:[Object(c.jsx)("input",{type:"checkbox",checked:a(t.id),name:t.id,onChange:function(t){n(t),r(e)}}),t.artists[0].name," - ",t.name]},t.id)}))},e.id)};var S=function(t){t.loadedData;var e,n=t.setLoadedData,a=Object(r.useState)([]),o=Object(i.a)(a,2),s=o[0],l=o[1],f=Object(r.useState)([]),d=Object(i.a)(f,2),j=d[0],k=d[1],p=Object(r.useState)([]),b=Object(i.a)(p,2),O=b[0],m=b[1],g=Object(r.useState)([]),S=Object(i.a)(g,2),y=S[0],T=S[1];function w(t){if(!(O.length>=5&&t.target.checked))if(O.some((function(e){return e.id===t.target.name})))m(O.filter((function(e){return e.id!==t.target.name})));else{var e=y.reduce((function(t,e){return[].concat(Object(u.a)(t),Object(u.a)(e.tracks))}),[]),n=j.tracks?j.tracks.filter((function(e){return e.id===t.target.name})):[];m([].concat(Object(u.a)(O),Object(u.a)(s.filter((function(e){return e.track.id===t.target.name})).map((function(t){return t.track}))),Object(u.a)(e.filter((function(e){return e.id===t.target.name}))),Object(u.a)(n)))}}function C(t){return O.some((function(e){return e.id===t}))}function I(t){y.some((function(e){return e.id===t.id}))||T([].concat(Object(u.a)(y),[t]))}return Object(r.useEffect)((function(){n((function(t){return[].concat(Object(u.a)(t),[{likedTracks:!1}])})),h("https://api.spotify.com/v1/me/tracks").then((function(t){return l(t.items)})).then((function(){n((function(t){return[].concat(Object(u.a)(t),[{likedTracks:!0}])}))}))}),[]),Object(r.useEffect)((function(){var t;0!==O.length&&(t=O,h("https://api.spotify.com/v1/recommendations?seed_tracks="+t.reduce((function(t,e,n){return 0===n?e.id:t+","+e.id}),""))).then((function(t){return k({id:x()(),tracks:t.tracks}||[])}))}),[O]),Object(c.jsxs)(c.Fragment,{children:[Object(c.jsxs)("p",{children:["Seeds: ",5-O.length]}),Object(c.jsx)("p",{children:"Liked tracks"}),Object(c.jsx)("ul",{children:s.length?s.map((function(t){return Object(c.jsxs)("li",{children:[Object(c.jsx)("input",{type:"checkbox",checked:C(t.track.id),name:t.track.id,onChange:w}),t.track.artists[0].name," - ",t.track.name]},t.track.id)})):"Loading liked tracks..."}),Object(c.jsx)("p",{children:"Recommended tracks"}),y.length?y.map((function(t){return Object(c.jsxs)("ul",{children:[Object(c.jsx)("button",{onClick:function(){return e=t.id,void T(y.filter((function(t){return t.id!==e})));var e},children:"Unpin"}),Object(c.jsx)(v,{playlist:t,toggleTracks:w,pinPlaylist:I,isChecked:C})]},t.id)})):"",Object(c.jsx)("ul",{children:(null===(e=j.tracks)||void 0===e?void 0:e.length)?Object(c.jsxs)(c.Fragment,{children:[Object(c.jsx)("button",{onClick:function(){return I(j)},children:"Pin"}),Object(c.jsx)(v,{playlist:j,toggleTracks:w,pinPlaylist:I,isChecked:C})]}):"Select up to 5 tracks as seeds for recommendations."})]})};var y=function(){var t=Object(r.useState)([]),e=Object(i.a)(t,2),n=e[0],a=e[1];return Object(c.jsxs)("div",{className:"App",children:[n.some((function(t){return!t}))?Object(c.jsx)("p",{children:"Loading..."}):"",Object(c.jsx)(m,{setLoadedData:a}),Object(c.jsx)(S,{setLoadedData:a})]})},T=function(t){t&&t instanceof Function&&n.e(3).then(n.bind(null,21)).then((function(e){var n=e.getCLS,c=e.getFID,r=e.getFCP,a=e.getLCP,o=e.getTTFB;n(t),c(t),r(t),a(t),o(t)}))};s.a.render(Object(c.jsx)(a.a.StrictMode,{children:Object(c.jsx)(y,{})}),document.getElementById("root")),T()}},[[20,1,2]]]);
//# sourceMappingURL=main.b0c9231d.chunk.js.map